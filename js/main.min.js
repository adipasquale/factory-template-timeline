var f=Joshfire.factory;var params=f.config.template.options.params;var dataEvents=f.getDataSource("events");var timeline_data,timeline_config;var event_list=[];dataEvents.find({},function(a,b){_.map(b.entries,function(e,c){var d={headline:e.name};if(e.hasOwnProperty("startDate")){d.startDate=e.startDate}else{if(e.hasOwnProperty("datePublished")){d.startDate=e.datePublished}else{if(e.hasOwnProperty("uploadDate")){d.startDate=e.uploadDate}else{if(e.hasOwnProperty("dateModified")){d.startDate=e.dateModified}}}}if(d.startDate!==undefined){if(e["@type"]=="Article"&&e.hasOwnProperty("associatedMedia")){d.asset={};if(e.associatedMedia.hasOwnProperty("url")){d.asset.media=e.associatedMedia.url}if(e.associatedMedia.hasOwnProperty("name")){d.asset.caption=e.associatedMedia.name}if(e.associatedMedia.hasOwnProperty("author")&&e.associatedMedia.author.hasOwnProperty("name")){d.asset.credit=e.associatedMedia.author.name}}else{if(e["@type"]=="Article/Status"&&e.hasOwnProperty("author")&&e.author[0]!==undefined){if(e.author[0].image!==undefined&&e.author[0].image.contentURL!==undefined){d.asset={};d.asset.media=e.author[0].image.contentURL;if(e.author[0]["foaf:nick"]!==undefined){d.asset.caption="<a href='"+e.author[0].url+"'>@"+e.author[0]["foaf:nick"]+"</a>"}}}}if(e["@type"]=="Event"){if(e.hasOwnProperty("startDate")){d.startDate=e.startDate}}else{if(e["@type"]=="VideoObject"){d.asset={};d.asset.media=e.url;if(e.hasOwnProperty("author")&&e.author.name!==undefined){d.asset.credit=e.author.name}}}if(e.hasOwnProperty("endDate")){d.endDate=e.endDate}if(d.asset===undefined&&e.hasOwnProperty("image")&&e.image.contentURL!==undefined){d.asset={media:e.image.contentURL}}if(d.text===undefined&&e.hasOwnProperty("description")){d.text=e.description}event_list.push(d)}});timeline_data={timeline:{headline:params.title||"Joshfire Timeline",type:"default",text:params.description||"",date:event_list}};timeline_config={width:"100%",height:"100%",source:timeline_data,font:params.font||"Bevan-PotanoSans",start_at_end:params.start_at_end||false,css:"css/timeline.css",js:"js/timeline-modified.min.js"};if(params.start_at_end!==undefined){_.extend(timeline_config,{start_at_end:true})}if(params.font!==undefined){_.extend(timeline_config,{font:params.font})}if(params.lang!==undefined){_.extend(timeline_config,{lang:params.lang})}$.getScript("js/timeline-embed.js",function(){if(params.custom_scrollbar){$.getScript("js/jquery.mousewheel.js",function(){$.getScript("js/jquery.jscrollpane.min.js",function(){loadScrollbars()})})}})});var emptyIterations=0;var loadScrollbars=function(){var a=$(".slider-item:not(.custom-scrollbar)").filter(function(){return this.style.display=="block"});if(a.length>0){a.jScrollPane();a.addClass("custom-scrollbar");emptyIterations=0}else{emptyIterations++}if(emptyIterations<100){window.setTimeout(loadScrollbars,2000)}};